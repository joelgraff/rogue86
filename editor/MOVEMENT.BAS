1 LOCATE 1,1
2 PRINT "FILES.BAS..."
3 MERGE "FILES.BAS"
3000 '----------------
3001 '--- Movement ---
3002 '----------------
3020 IF CMD.ACTIVE = CMD.MOV.RT OR CMD.ACTIVE = CMD.MOV.LT THEN GOTO 3100
3030 IF CMD.ACTIVE = CMD.MOV.UP OR CMD.ACTIVE = CMD.MOV.DN THEN GOTO 3200
3040 IF CMD.ACTIVE = CMD.MOV.ROW.LT OR CMD.ACTIVE = CMD.MOV.ROW.RT THEN GOTO 3500
3050 IF CMD.ACTIVE = CMD.MOV.COL.TOP OR CMD.ACTIVE = CMD.MOV.COL.BOT THEN GOTO 3600
3060 IF CMD.ACTIVE = CMD.MOV.PAGE.UP OR CMD.ACTIVE = CMD.MOV.PAGE.DN THEN GOTO 3700
3080 RETURN
3100 '----------------------
3101 '---Move Horizontal---
3102 '----------------------
3110 OFFSET.DELTA = 2
3120 IF CMD.ACTIVE = CMD.MOV.LT THEN OFFSET.DELTA = -2
3130 X = OFFSET.CURRENT + OFFSET.DELTA
3140 IF X > PAGE.LENGTH - 2 THEN OFFSET.DELTA = 0
3150 IF X < 0 THEN OFFSET.DELTA = PAGE.LENGTH - 2
3160 FLAG.REDRAW.CRSR = TRUE
3170 RETURN
3200 '-------------------
3210 '---Move Vertical---
3220 '-------------------
3230 OFFSET.DELTA = 160
3240 IF CMD.ACTIVE = CMD.MOV.UP THEN OFFSET.DELTA = -160
3250 X = OFFSET.CURRENT + OFFSET.DELTA
3260 IF X < 0 THEN OFFSET.DELTA = PAGE.LENGTH - 160
3270 IF X > PAGE.LENGTH - 2 THEN OFFSET.DELTA = -PAGE.LENGTH + 160
3275 FLAG.REDRAW.CRSR = TRUE
3280 RETURN
3500 '------------------------------------
3510 '--- MOVE TO START OR END OF LINE ---
3511 '------------------------------------
3512 X = INT(OFFSET.CURRENT / 160) * 160
3520 OFFSET.DELTA = X - OFFSET.CURRENT
3530 IF CMD.ACTIVE = CMD.MOV.ROW.RT THEN OFFSET.DELTA = OFFSET.DELTA + 158
3535 FLAG.REDRAW.CRSR = TRUE
3540 RETURN
3600 '------------------------------------
3610 '--- MOVE TOP OR BOTTOM OF COLUMN ---
3620 '------------------------------------
3630 OFFSET.DELTA = PAGE.LENGTH - OFFSET.CURRENT - (160 - OFFSET.CURRENT MOD 160)
3640 IF CMD.ACTIVE =  CMD.MOV.COL.TOP THEN OFFSET.DELTA = -OFFSET.CURRENT + (OFFSET.CURRENT MOD 160)
3645 FLAG.REDRAW.CRSR = TRUE
3650 RETURN
3700 '--------------------
3710 '--- SWITCH PAGES ---
3720 '--------------------
3722 ATTR.PREVIOUS = PEEK(OFFSET.PREVIOUS + 1)
3725 ATTR.CURRENT = PEEK(OFFSET.CURRENT + 1)
3728 DELTA = &H100
3730 'IF A$ = "Z" THEN PAGE.CURRENT = PAGE.CURRENT - &H100
3735 IF CMD.ACTIVE = CMD.MOV.PG.DN THEN DELTA = -&H100
3740 'IF A$ = "C" THEN PAGE.CURRENT = PAGE.CURRENT + &H100
3745 PAGE.CURRENT = PAGE.CURRENT + DELTA
3760 IF PAGE.CURRENT <> &HBB0A THEN PAGE.CURRENT = &HBB0A
3780 PAGE.INDEX = INT((PAGE.CURRENT - &HB80A) / &H100)
3790 SCREEN , , PAGE.INDEX, PAGE.INDEX
3791 GOSUB 2500
3792 FLAG.REDRAW.CRSR = TRUE
3799 RETURN
